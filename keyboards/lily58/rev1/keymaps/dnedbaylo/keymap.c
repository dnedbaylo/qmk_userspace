#include QMK_KEYBOARD_H

enum layer_number {
  _BASE = 0,
  _LAYER1,
  _LAYER2,
  _NAV,
};

#define LAY1 MO(_LAYER1)
#define LAY2 MO(_LAYER2)
#define NAV TG(_NAV)

// COMMAND+LEFT - for Mac "Home"
#define CMD_LEFT LCMD(KC_LEFT)
// COMMAND+RIGHT - for Mac "End"
#define CMD_RGHT LCMD(KC_RGHT)

// OPT+LEFT - word left
#define OPT_LEFT LOPT(KC_LEFT)
// OPT+RIGHT - word right
#define OPT_RGHT LOPT(KC_RGHT)

/* Template
 * ,-------------1--------2--------3--------4--------5---.                     ,----6--------7--------8--------9-------0-------------.
 * |  ESC   |        |        |        |        |        |                     |        |        |        |        |        | BackSP |
 * |--------+----q---+----w---+----e---+----r---+----t---|                     |----y---+----u---+----i---+----o---+---p----+--------|
 * |  TAB   |        |        |        |        |        |                     |        |        |        |        |        | Enter  |
 * |--------+----a---+----s---+----d---+----f---+----g---|                     |----h---+----j---+----k---+----l---+---;:---+---'"---|
 * |  CAPS  |        |        |        |        |        |--------.   ,--------|        |        |        |        |        |        |
 * |--------+----z---+----x---+----c---+----v---+----b---|        |   |        |----n---+----m---+----,<--+----.>--+---/?---+--------|
 * | LShift |        |        |        |        |        |--------|   |--------|        |        |        |        |        | RShift |
 * `----------------------------------------------------/        /     \        \----------------------------------------------------'
 *                        |  LCtl  |  LOpt  |  LCmd  | /  Space /       \ Space  \ | Layer1 | Layer2 |  Nav   |
 *                        `--------------------------''--------'         '--------''--------------------------'
*/
/*
[_LAY1] = LAYOUT(
// ,---esc------1--------2--------3--------4--------5----.                     ,---6--------7--------8--------9--------0--------bsp--.
// |        |        |        |        |        |        |                     |        |        |        |        |        |        |
    _______, _______, _______, _______, _______, _______,                       _______, _______, _______, _______, _______, _______,
// |        |        |        |        |        |        |                     |        |        |        |        |        |        |
// |---tab--+---q----+---w----+---e----+---r----+---t----|                     |---y----+---u----+---i----+---o----+---p----+--ent---|
// |        |        |        |        |        |        |                     |        |        |        |        |        |        |
    _______, _______, _______, _______, _______, _______,                       _______, _______, _______, _______, _______, _______,
// |        |        |        |        |        |        |                     |        |        |        |        |        |        |
// |--caps--+---a----+---s----+---d----+---f----+---g----|                     |---h----+---j----+---k----+---l----+---;:---+---'"---|
// |        |        |        |        |        |        |                     |        |        |        |        |        |        |
    _______, _______, _______, _______, _______, _______,                       _______, _______, _______, _______, _______, _______,
// |        |        |        |        |        |        |--------.   ,--------|        |        |        |        |        |        |
// |--shft--+---z----+---x----+---c----+---v----+---b----|        |   |        |---n----+---m----+---,<---+---.>---+---/?---+--shft--|
    _______, _______, _______, _______, _______, _______, _______,     _______, _______, _______, _______, _______, _______, _______,
// |        |        |        |        |        |        |--------|   |--------|        |        |        |        |        |        |
// `----------------------------------------------------/        /     \        \----------------------------------------------------'
//                        |        |        |        | /        /       \        \ |        |        |        |
                            _______, _______, _______,   _______,         _______,   _______, _______, _______
//                        `--------------------------''--------'         '--------''--------------------------'
),
*/

const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {

 /* Base layer
  * ,-------------1--------2--------3--------4--------5---.                     ,----6--------7--------8--------9-------0-------------.
  * |  ESC   |    1   |    2   |    3   |    4   |    5   |                     |    6   |    7   |    8   |    9   |   0    | BackSP |
  * |--------+----q---+----w---+----e---+----r---+----t---|                     |----y---+----u---+----i---+----o---+---p----+--------|
  * |  TAB   |    Q   |    W   |    E   |    R   |    T   |                     |    Y   |    U   |    I   |    O   |   P    | Enter  |
  * |--------+----a---+----s---+----d---+----f---+----g---|                     |----h---+----j---+----k---+----l---+---;:---+---'"---|
  * |  CAPS  |    A   |    S   |    D   |    F   |    G   |--------.   ,--------|    H   |    J   |    K   |    L   |   ;    |   '    |
  * |--------+----z---+----x---+----c---+----v---+----b---|   [    |   |   ]    |----n---+----m---+----,<--+----.>--+---/?---+--------|
  * | LShift |    Z   |    X   |    C   |    V   |    B   |--------|   |--------|    N   |    M   |    ,   |    .   |   /    | RShift |
  * `----------------------------------------------------/        /     \        \----------------------------------------------------'
  *                        |  LCtl  |  LOpt  |  LCmd  | /  Space /       \ Space  \ | Layer1 | Layer2 |  Nav   |
  *                        `--------------------------''--------'         '--------''--------------------------'
 */

 [_BASE] = LAYOUT(
     KC_ESC,  KC_1,    KC_2,    KC_3,    KC_4,    KC_5,                          KC_6,    KC_7,    KC_8,    KC_9,    KC_0,    KC_BSPC,
     KC_TAB,  KC_Q,    KC_W,    KC_E,    KC_R,    KC_T,                          KC_Y,    KC_U,    KC_I,    KC_O,    KC_P,    KC_ENT,
     KC_CAPS, KC_A,    KC_S,    KC_D,    KC_F,    KC_G,                          KC_H,    KC_J,    KC_K,    KC_L,    KC_SCLN, KC_QUOT,
     KC_LSFT, KC_Z,    KC_X,    KC_C,    KC_V,    KC_B,    KC_LBRC,     KC_RBRC, KC_N,    KC_M,    KC_COMM, KC_DOT,  KC_SLSH, KC_RSFT,
                            KC_LCTL, KC_LALT, KC_LGUI,   KC_SPC,          KC_SPC,    LAY1,    LAY2,    NAV
),

/* LAYER 1
 * ,--esc--------1--------2--------3--------4--------5---.                     ,----6--------7--------8--------9-------0-------back--.
 * |  ESC   |   F1   |   F2   |   F3   |   F4   |   F5   |                     |   F6   |   F7   |   F8   |   F9   |  F10   |  Del   |
 * |--tab---+----q---+----w---+----e---+----r---+----t---|                     |----y---+----u---+----i---+----o---+---p----+---ent--|
 * |  TAB   |        |CMD_LEFT|CMD_RGHT|        |        |                     |    =   |    _   |    |   |    \   | PageUp |  Home  |
 * |--caps--+----a---+----s---+----d---+----f---+----g---|                     |----h---+----j---+----k---+----l---+---;:---+---'"---|
 * |  CAPS  |        |        |   DEL  |OPT_RGHT|        |--------.   ,--------|  Left  |  Down  |   Up   |  Right |   +    |  End   |
 * |--shft--+----z---+----x---+----c---+----v---+----b---|   {    |   |   }    |----n---+----m---+----,<--+----.>--+---/?---+--shft--|
 * | LShift |        |        |        |        |OPT_LEFT|--------|   |--------| PageDn |  Left  |  Down  |  Right |   -    | RShift |
 * `----------------------------------------------------/        /     \        \----------------------------------------------------'
 *                        |  LCtl  |  LOpt  |  LCmd  | /  Space /       \ Space  \ |        |        |        |
 *                        `--------------------------''--------'         '--------''--------------------------'                        */
[_LAYER1] = LAYOUT(
/* ,------------1--------2--------3--------4--------5----.                     ,---6--------7--------8--------9--------0-------------.
 * |        |        |        |        |        |        |                     |        |        |        |        |        |        | */
    _______,  KC_F1,   KC_F2,   KC_F3,   KC_F4,   KC_F5,                         KC_F6,   KC_F7,   KC_F8,   KC_F9,   KC_F10, KC_DEL,
/* |        |        |        |        |        |        |                     |        |        |        |        |        |        | */
/* |--------+---q----+---w----+---e----+---r----+---t----|                     |---y----+---u----+---i----+---o----+---p----+--ent---|
 * |        |        |        |        |        |        |                     |        |        |        |        |        |        | */
    _______, _______, CMD_LEFT,CMD_RGHT,_______, _______,                       KC_EQL,  KC_UNDS, KC_PIPE, KC_BSLS, KC_PGUP, KC_HOME,
/* |        |        |        |        |        |        |                     |        |        |        |        |        |        | */
/* |--------+---a----+---s----+---d----+---f----+---g----|                     |---h----+---j----+---k----+---l----+---;:---+---'"---|
 * |        |        |        |        |        |        |                     |        |        |        |        |        |        | */
    _______, _______, _______, KC_DEL,  OPT_RGHT,_______,                       KC_LEFT, KC_DOWN, KC_UP,   KC_RGHT, KC_PLUS, KC_END,
/* |        |        |        |        |        |        |--------.   ,--------|        |        |        |        |        |        |
 * |--------+---z----+---x----+---c----+---v----+---b----|        |   |        |---n----+---m----+---,<---+---.>---+---/?---+--------| */
    _______, _______, _______, _______, _______, OPT_LEFT,KC_LCBR,     KC_RCBR, KC_PGDN, KC_LEFT, KC_DOWN, KC_RGHT, KC_MINS, _______,
/* |        |        |        |        |        |        |--------|   |--------|        |        |        |        |        |        |
 * `----------------------------------------------------/        /     \        \----------------------------------------------------'
 *                        |        |        |        | /        /       \        \ |        |        |        |                        */
                           _______, _______, _______,   _______,         _______,   _______, _______, _______
/*                        `--------------------------''--------'         '--------''--------------------------'                        */
),

/* Layer2
 * Media control layer
 *
 * ,-------------1--------2--------3--------4--------5---.                     ,----6--------7--------8--------9-------0-------------.
 * |  ESC   |        |        |        |        |        |                     |        |        |        |        |        | BackSP |
 * |--------+----q---+----w---+----e---+----r---+----t---|                     |----y---+----u---+----i---+----o---+---p----+--------|
 * |  TAB   |        |        |        |        |        |                     |        |        | VolUp  | VolDown| Play   | Enter  |
 * |--------+----a---+----s---+----d---+----f---+----g---|                     |----h---+----j---+----k---+----l---+---;:---+---'"---|
 * |  CAPS  |        |        |        |        |        |--------.   ,--------|        |        |        |        |        |        |
 * |--------+----z---+----x---+----c---+----v---+----b---|        |   |        |----n---+----m---+----,<--+----.>--+---/?---+--------|
 * | LShift |        |        |        |        |        |--------|   |--------|  Next  |        |        |        |        | RShift |
 * `----------------------------------------------------/        /     \        \----------------------------------------------------'
 *                        |  LCtl  |  LOpt  |  LCmd  | /  Space /       \ Space  \ | Layer1 | Layer2 | Layer3 |
 *                        `--------------------------''--------'         '--------''--------------------------'
*/

[_LAYER2] = LAYOUT(
// ,---esc------1--------2--------3--------4--------5----.                     ,---6--------7--------8--------9--------0--------bsp--.
// |        |        |        |        |        |        |                     |        |        |        |        |        |        |
    _______, _______, _______, _______, _______, _______,                       _______, _______, _______, _______, _______, _______,
// |        |        |        |        |        |        |                     |        |        |        |        |        |        |
// |---tab--+---q----+---w----+---e----+---r----+---t----|                     |---y----+---u----+---i----+---o----+---p----+--ent---|
// |        |        |        |        |        |        |                     |        |        |        |        |        |        |
    _______, _______, _______, _______, _______, _______,                       _______, _______, KC_VOLD, KC_VOLU, KC_MPLY, _______,
// |        |        |        |        |        |        |                     |        |        |        |        |        |        |
// |--caps--+---a----+---s----+---d----+---f----+---g----|                     |---h----+---j----+---k----+---l----+---;:---+---'"---|
// |        |        |        |        |        |        |                     |        |        |        |        |        |        |
    _______, _______, _______, _______, _______, _______,                       _______, _______, _______, _______, _______, _______,
// |        |        |        |        |        |        |--------.   ,--------|        |        |        |        |        |        |
// |--shft--+---z----+---x----+---c----+---v----+---b----|        |   |        |---n----+---m----+---,<---+---.>---+---/?---+--shft--|
    _______, _______, _______, _______, _______, _______, _______,     _______, _______, KC_MUTE, KC_MPRV, KC_MNXT, _______, _______,
// |        |        |        |        |        |        |--------|   |--------|        |        |        |        |        |        |
// `----------------------------------------------------/        /     \        \----------------------------------------------------'
//                        |        |        |        | /        /       \        \ |        |        |        |
                            _______, _______, _______,   _______,         _______,   _______, _______, _______
//                        `--------------------------''--------'         '--------''--------------------------'
),

/* Navigation layer
 * ,-------------1--------2--------3--------4--------5---.                     ,----6--------7--------8--------9-------0-------------.
 * |  ESC   |        |        |        |        |        |                     |        |        |        |        |        | BackSP |
 * |--------+----q---+----w---+----e---+----r---+----t---|                     |----y---+----u---+----i---+----o---+---p----+--------|
 * |  TAB   |        |        |        |        |        |                     |        |        |        |        |        | Enter  |
 * |--------+----a---+----s---+----d---+----f---+----g---|                     |----h---+----j---+----k---+----l---+---;:---+---'"---|
 * |  CAPS  |        |        |        |        |        |--------.   ,--------|        |        |        |        |        |        |
 * |--------+----z---+----x---+----c---+----v---+----b---|        |   |        |----n---+----m---+----,<--+----.>--+---/?---+--------|
 * | LShift |        |        |        |        |        |--------|   |--------|        |        |        |        |        | RShift |
 * `----------------------------------------------------/        /     \        \----------------------------------------------------'
 *                        |  LCtl  |  LOpt  |  LCmd  | /  Space /       \ Space  \ | Layer1 | Layer2 | Layer3 |
 *                        `--------------------------''--------'         '--------''--------------------------'
*/

[_NAV] = LAYOUT(
// ,---esc------1--------2--------3--------4--------5----.                     ,---6--------7--------8--------9--------0--------bsp--.
// |        |        |        |        |        |        |                     |        |        |        |        |        |        |
    _______, _______, _______, _______, _______, _______,                       _______, _______, _______, _______, _______, _______,
// |        |        |        |        |        |        |                     |        |        |        |        |        |        |
// |---tab--+---q----+---w----+---e----+---r----+---t----|                     |---y----+---u----+---i----+---o----+---p----+--ent---|
// |        |        |        |        |        |        |                     |        |        |        |        |        |        |
    _______, _______, _______, _______, _______, _______,                       KC_WH_L, KC_WH_D, KC_WH_U, KC_WH_R, KC_PGUP, KC_HOME,
// |        |        |        |        |        |        |                     |        |        |        |        |        |        |
// |--caps--+---a----+---s----+---d----+---f----+---g----|                     |---h----+---j----+---k----+---l----+---;:---+---'"---|
// |        |        |        |        |        |        |                     |        |        |        |        |        |        |
    _______, _______, _______, _______, _______, _______,                       KC_LEFT, KC_DOWN, KC_UP,   KC_RGHT, KC_PGDN, KC_END,
// |        |        |        |        |        |        |--------.   ,--------|        |        |        |        |        |        |
// |--shft--+---z----+---x----+---c----+---v----+---b----|        |   |        |---n----+---m----+---,<---+---.>---+---/?---+--shft--|
    _______, _______, _______, _______, _______, _______, _______,     _______, CMD_LEFT,OPT_LEFT,OPT_RGHT,CMD_RGHT, _______, _______,
// |        |        |        |        |        |        |--------|   |--------|        |        |        |        |        |        |
// `----------------------------------------------------/        /     \        \----------------------------------------------------'
//                        |        |        |        | /        /       \        \ |        |        |        |
                            _______, _______, _______,   _______,         _______,   _______, _______, _______
//                        `--------------------------''--------'         '--------''--------------------------'
),
};

/*layer_state_t layer_state_set_user(layer_state_t state) {
  return update_tri_layer_state(state, _LOWER, _RAISE, _ADJUST);
  }*/

//SSD1306 OLED update loop, make sure to enable OLED_ENABLE=yes in rules.mk
#ifdef OLED_ENABLE

oled_rotation_t oled_init_user(oled_rotation_t rotation) {
    return OLED_ROTATION_270;
}

// When you add source files to SRC in rules.mk, you can use functions.
const char *read_mode_icon(bool swap);

static const char imageNavLayer [] PROGMEM = {
    // 'oled-n', 32x128px
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0xff, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
    0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0xff,
    0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0x80, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff,
    0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xfc, 0xe0, 0x00,
    0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff,
    0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0x0f, 0x7f, 0xff, 0xff, 0xff,
    0xfc, 0xe0, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff,
    0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0x01, 0x0f, 0x7f,
    0xff, 0xff, 0xff, 0xf8, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff,
    0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x03, 0x0f, 0x7f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff,
    0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x03, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff,
    0xff, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,
    0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0xff
};


uint8_t previous_layer = -1;

void update_left_oled(void){
    oled_set_cursor(0, 0);
    if(get_highest_layer(layer_state) != previous_layer){
        oled_clear();
    }
    previous_layer = get_highest_layer(layer_state);
    if(get_highest_layer(layer_state) == _NAV){
        oled_write_raw_P(imageNavLayer, sizeof(imageNavLayer));
    }
    oled_write_ln(read_mode_icon(keymap_config.swap_lalt_lgui), false);
}

bool oled_task_user(void) {
  if (is_keyboard_master()) {
      update_left_oled();
  }
  return false;
}


#endif // OLED_ENABLE
